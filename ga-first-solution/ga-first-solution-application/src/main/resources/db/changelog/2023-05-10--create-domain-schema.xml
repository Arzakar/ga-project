<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.17.xsd">

    <changeSet id="2023-05-10--01-create-engine-table.xml" author="Stepan_Klimashin">
        <createTable tableName="engine">
            <column name="id" type="uuid">
                <constraints primaryKey="true"
                             primaryKeyName="engine_pk"/>
            </column>
            <column name="name" type="varchar">
                <constraints nullable="false"/>
            </column>
            <column name="thrust" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="fuel_consumption" type="double">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <sql>
            ALTER TABLE engine
            ADD CONSTRAINT positive_thrust_constraint
            CHECK (thrust > 0);

            ALTER TABLE engine
            ADD CONSTRAINT positive_fuel_consumption_constraint
            CHECK (fuel_consumption > 0);
        </sql>
    </changeSet>

    <changeSet id="2023-05-10--02-create-spacecraft-table" author="Stepan_Klimashin">
        <createTable tableName="spacecraft">
            <column name="id" type="uuid">
                <constraints primaryKey="true"
                             primaryKeyName="spacecraft_pk"/>
            </column>
            <column name="dry_mass" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="start_fuel_mass" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="engine_id" type="uuid">
                <constraints nullable="false"
                             foreignKeyName="spacecraft_to_engine_fk"
                             referencedTableName="engine"
                             referencedColumnNames="id"/>
            </column>
            <column name="engine_count" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <sql>
            ALTER TABLE spacecraft
            ADD CONSTRAINT positive_dry_mass_constraint
            CHECK (dry_mass > 0);

            ALTER TABLE spacecraft
            ADD CONSTRAINT positive_start_fuel_mass_constraint
            CHECK (start_fuel_mass >= 0);
        </sql>
    </changeSet>

    <changeSet id="2023-05-10--03-create-celestial-body-table" author="Stepan_Klimashin">
        <createTable tableName="celestial_body">
            <column name="id" type="uuid">
                <constraints primaryKey="true"
                             primaryKeyName="celestial_body_pk"/>
            </column>
            <column name="name" type="varchar">
                <constraints nullable="false"
                             unique="true"/>
            </column>
            <column name="mass" type="double">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <sql>
            ALTER TABLE celestial_body
            ADD CONSTRAINT positive_mass_constraint
            CHECK (mass > 0);
        </sql>
    </changeSet>

    <changeSet id="2023-05-10--04-create-orbit-table" author="Stepan_Klimashin">
        <createTable tableName="orbit">
            <column name="id" type="uuid">
                <constraints primaryKey="true"
                             primaryKeyName="orbit_pk"/>
            </column>
            <column name="celestial_body_id" type="uuid">
                <constraints nullable="false"
                             foreignKeyName="orbit_to_celestial_body_fk"
                             referencedTableName="celestial_body"
                             referencedColumnNames="id"/>
            </column>
            <column name="semi_major_axis" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="eccentricity" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="inclination" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="longitude_asc_node" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="perihelion_argument" type="double">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <sql>
            ALTER TABLE orbit
            ADD CONSTRAINT positive_semi_major_axis_constraint
            CHECK (semi_major_axis > 0);
        </sql>
    </changeSet>

    <changeSet id="2023-05-25--05-create-initial-state-table" author="Stepan_Klimashin">
        <createTable tableName="initial_state">
            <column name="id" type="uuid">
                <constraints primaryKey="true"
                             primaryKeyName="initial_state_pk"/>
            </column>
            <column name="result_state_id" type="uuid"/>
            <column name="central_body_id" type="uuid">
                <constraints nullable="false"
                             foreignKeyName="initial_state_to_celestial_body_fk"
                             referencedTableName="celestial_body"
                             referencedColumnNames="id"/>
            </column>
            <column name="spacecraft_id" type="uuid">
                <constraints nullable="false"
                             foreignKeyName="initial_state_to_spacecraft_fk"
                             referencedTableName="spacecraft"
                             referencedColumnNames="id"/>
            </column>
            <column name="spacecraft_position_x" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_position_y" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_position_z" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_speed_x" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_speed_y" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_speed_z" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="command_profile_type" type="varchar">
                <constraints nullable="false"/>
            </column>
            <column name="command_profile_payload" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="target_state_type" type="varchar">
                <constraints nullable="false"/>
            </column>
            <column name="target_state_payload" type="text">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2023-05-25--06-create-initial-state-celestial-body-part-table" author="Stepan_Klimashin">
        <createTable tableName="initial_state_celestial_body_part">
            <column name="id" type="uuid">
                <constraints primaryKey="true"
                             primaryKeyName="initial_state_celestial_body_part_pk"/>
            </column>
            <column name="initial_state_id" type="uuid">
                <constraints nullable="false"
                             foreignKeyName="initial_state_celestial_body_part_to_initial_state_fk"
                             referencedTableName="initial_state"
                             referencedColumnNames="id"/>
            </column>
            <column name="celestial_body_id" type="uuid">
                <constraints nullable="false"
                             foreignKeyName="initial_state_celestial_body_part_to_celestial_body_fk"
                             referencedTableName="celestial_body"
                             referencedColumnNames="id"/>
            </column>
            <column name="true_anomaly" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2023-05-25--07-create-result-state-table" author="Stepan_Klimashin">
        <createTable tableName="result_state">
            <column name="id" type="uuid">
                <constraints primaryKey="true"
                             primaryKeyName="result_state_pk"/>
            </column>
            <column name="initial_state_id" type="uuid">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_id" type="uuid">
                <constraints nullable="false"
                             foreignKeyName="initial_state_to_spacecraft_fk"
                             referencedTableName="spacecraft"
                             referencedColumnNames="id"/>
            </column>
            <column name="spacecraft_position_x" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_position_y" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_position_z" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_speed_x" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_speed_y" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="spacecraft_speed_z" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="finish_fuel_mass" type="double">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="varchar">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="text"/>
        </createTable>
        <sql>
            ALTER TABLE result_state
            ADD CONSTRAINT positive_finish_fuel_mass_constraint
            CHECK (finish_fuel_mass > 0);
        </sql>
    </changeSet>

    <changeSet id="2023-05-25--08-create-result-state-celestial-body-part-table" author="Stepan_Klimashin">
        <createTable tableName="result_state_celestial_body_part">
            <column name="id" type="uuid">
                <constraints primaryKey="true"
                             primaryKeyName="result_state_celestial_body_part_pk"/>
            </column>
            <column name="result_state_id" type="uuid">
                <constraints nullable="false"
                             foreignKeyName="result_state_celestial_body_part_to_result_state_fk"
                             referencedTableName="result_state"
                             referencedColumnNames="id"/>
            </column>
            <column name="celestial_body_id" type="uuid">
                <constraints nullable="false"
                             foreignKeyName="initial_state_celestial_body_part_to_celestial_body_fk"
                             referencedTableName="celestial_body"
                             referencedColumnNames="id"/>
            </column>
            <column name="true_anomaly" type="double" defaultOnNull="true" defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2023-05-25--09-link-initial-and-result-tables" author="Stepan_Klimashin">
        <addForeignKeyConstraint baseTableName="initial_state"
                                 baseColumnNames="result_state_id"
                                 constraintName="initial_state_to_result_state_fk"
                                 referencedTableName="result_state"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="result_state"
                                 baseColumnNames="initial_state_id"
                                 constraintName="result_state_to_initial_state_fk"
                                 referencedTableName="initial_state"
                                 referencedColumnNames="id"/>
    </changeSet>

</databaseChangeLog>